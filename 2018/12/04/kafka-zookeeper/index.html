<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="learn python and invest"><meta name="keywords" content="金融, Python"><title>kafka集群搭建 - ZooKeeper | KeKeFund</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.3.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">kafka集群搭建 - ZooKeeper</h1><a id="logo" href="/.">KeKeFund</a><p class="description">金融 · Python · 技术博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">kafka集群搭建 - ZooKeeper</h1><div class="post-meta">Dec 4, 2018<span> | </span><span class="category"><a href="/categories/系统架构/">系统架构</a></span><span> | </span><span id="busuanzi_value_page_pv"></span><span> Hits</span></div><div class="post-content"><h1 id="一、什么是ZooKeeper？"><a href="#一、什么是ZooKeeper？" class="headerlink" title="一、什么是ZooKeeper？"></a>一、什么是ZooKeeper？</h1><p>ZooKeeper（动物园管理员），顾名思义，是用来管理Hadoop（大象）、Hive（蜜蜂）、Pig（小猪）的管理员，同时Apache HBase、Apache Solr、LinkedIn Sensei等众多项目中都采用了ZooKeeper。<br><a id="more"></a></p>
<p>ZooKeeper是一个集中式服务，用于维护配置信息、命名、提供分布式同步和提供组服务。所有这些类型的服务都以某种形式被分布式应用程序使用。每次它们被实现时，都有大量的工作用于修复不可避免的bug和竞选条件。由于实现这类服务的困难，应用程序最初通常跳过它们，这使得它们在存在更改时变得脆弱，并且难以管理。即使正确完成，这些服务的不同实现也会在部署应用程序时导致管理复杂性。</p>
<h1 id="二、Zookeeper集群"><a href="#二、Zookeeper集群" class="headerlink" title="二、Zookeeper集群"></a>二、Zookeeper集群</h1><p>Kafka使用Zookeeper来存储集群元数据以及消费者元数据。Zookeeper集群被称为群组。Zookeeper使用的是一致性协议，所以建议每个群组里应该包含奇数个节点（比如3个、5个等），因为只有当群组里的大多数节点（也就是法定人数）处于可用状态，Zookeeper才能处理外部的请求。也就是说，如果3个节点的集群，允许1个节点失效。如果5个节点的集群，允许2个节点失效。</p>
<h1 id="三、Docker方式配置ZooKeeper"><a href="#三、Docker方式配置ZooKeeper" class="headerlink" title="三、Docker方式配置ZooKeeper"></a>三、Docker方式配置ZooKeeper</h1><p>myid文件：标识要写到快照目录下面myid文件里</p>
<p>采用Docker镜像：wurstmeister/zookeeper，部署一个3节点的集群。</p>
<h2 id="节点一："><a href="#节点一：" class="headerlink" title="节点一："></a>节点一：</h2><ul>
<li>docker-compose.yml</li>
</ul>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">version</span>: <span class="string">'2'</span></div><div class="line">service<span class="variable">s:</span></div><div class="line">  zookeeper:</div><div class="line">    image: wurstmeister/zookeeper</div><div class="line">    volume<span class="variable">s:</span></div><div class="line">      - ./zoo.<span class="keyword">cf</span><span class="variable">g:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/<span class="keyword">conf</span>/zoo.cfg</div><div class="line">      - ./dat<span class="variable">a:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/data</div><div class="line">      - ./<span class="built_in">log</span><span class="variable">s:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/logs</div><div class="line">      - ./myid:/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/data/myid</div><div class="line">    port<span class="variable">s:</span></div><div class="line">      - <span class="string">"2181:2181"</span></div><div class="line">      - <span class="string">"2888:2888"</span></div><div class="line">      - <span class="string">"3888:3888"</span></div><div class="line">    restar<span class="variable">t:</span> always</div></pre></td></tr></table></figure>
<ul>
<li><p>myid文件</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span></div></pre></td></tr></table></figure>
</li>
<li><p>zoo.cfg文件</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># The number of milliseconds of each tick</span></div><div class="line"><span class="attr">tickTime=2000</span></div><div class="line"><span class="comment"># The number of ticks that the initial</span></div><div class="line"><span class="comment"># synchronization phase can take</span></div><div class="line"><span class="attr">initLimit=10</span></div><div class="line"><span class="comment"># The number of ticks that can pass between</span></div><div class="line"><span class="comment"># sending a request and getting an acknowledgement</span></div><div class="line"><span class="attr">syncLimit=5</span></div><div class="line"><span class="comment"># the directory where the snapshot is stored.</span></div><div class="line"><span class="comment"># do not use /tmp for storage, /tmp here is just</span></div><div class="line"><span class="comment"># example sakes.</span></div><div class="line"><span class="attr">dataDir=/opt/zookeeper-3.4.9/data</span></div><div class="line"><span class="attr">dataLogDir=/opt/zookeeper-3.4.9/logs</span></div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line"><span class="attr">clientPort=2181</span></div><div class="line"><span class="comment"># the maximum number of client connections.</span></div><div class="line"><span class="comment"># increase this if you need to handle more clients</span></div><div class="line"><span class="comment">#maxClientCnxns=60</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Be sure to read the maintenance section of the</span></div><div class="line"><span class="comment"># administrator guide before turning on autopurge.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The number of snapshots to retain in dataDir</span></div><div class="line">autopurge.<span class="attr">snapRetainCount=3</span></div><div class="line"><span class="comment"># Purge task interval in hours</span></div><div class="line"><span class="comment"># Set to "0" to disable auto purge feature</span></div><div class="line">autopurge.<span class="attr">purgeInterval=1</span></div><div class="line"></div><div class="line"><span class="comment">#kafka01 (10.100.158.245)</span></div><div class="line">server.<span class="number">1</span>=<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">2888</span>:<span class="number">3888</span></div><div class="line"><span class="comment">#kafka02 (10.100.19.15)</span></div><div class="line">server.<span class="number">2</span>=<span class="number">10.150</span>.<span class="number">19.15</span>:<span class="number">2888</span>:<span class="number">3888</span></div><div class="line"><span class="comment">#kafka03 (10.100.124.217)</span></div><div class="line">server.<span class="number">3</span>=<span class="number">10.100</span>.<span class="number">124.217</span>:<span class="number">2888</span>:<span class="number">3888</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="节点二："><a href="#节点二：" class="headerlink" title="节点二："></a>节点二：</h2><ul>
<li><p>docker-compose.yml</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">version</span>: <span class="string">'2'</span></div><div class="line">service<span class="variable">s:</span></div><div class="line">  zookeeper:</div><div class="line">    image: wurstmeister/zookeeper</div><div class="line">    volume<span class="variable">s:</span></div><div class="line">      - ./zoo.<span class="keyword">cf</span><span class="variable">g:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/<span class="keyword">conf</span>/zoo.cfg</div><div class="line">      - ./dat<span class="variable">a:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/data</div><div class="line">      - ./<span class="built_in">log</span><span class="variable">s:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/logs</div><div class="line">      - ./myid:/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/data/myid</div><div class="line">    port<span class="variable">s:</span></div><div class="line">      - <span class="string">"2180:2181"</span></div><div class="line">      - <span class="string">"2888:2888"</span></div><div class="line">      - <span class="string">"3888:3888"</span></div><div class="line">    restar<span class="variable">t:</span> always</div></pre></td></tr></table></figure>
</li>
<li><p>myid文件</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
</li>
<li><p>zoo.cfg文件</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># The number of milliseconds of each tick</span></div><div class="line"><span class="attr">tickTime=2000</span></div><div class="line"><span class="comment"># The number of ticks that the initial</span></div><div class="line"><span class="comment"># synchronization phase can take</span></div><div class="line"><span class="attr">initLimit=10</span></div><div class="line"><span class="comment"># The number of ticks that can pass between</span></div><div class="line"><span class="comment"># sending a request and getting an acknowledgement</span></div><div class="line"><span class="attr">syncLimit=5</span></div><div class="line"><span class="comment"># the directory where the snapshot is stored.</span></div><div class="line"><span class="comment"># do not use /tmp for storage, /tmp here is just</span></div><div class="line"><span class="comment"># example sakes.</span></div><div class="line"><span class="attr">dataDir=/opt/zookeeper-3.4.9/data</span></div><div class="line"><span class="attr">dataLogDir=/opt/zookeeper-3.4.9/logs</span></div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line"><span class="attr">clientPort=2181</span></div><div class="line"><span class="comment"># the maximum number of client connections.</span></div><div class="line"><span class="comment"># increase this if you need to handle more clients</span></div><div class="line"><span class="comment">#maxClientCnxns=60</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Be sure to read the maintenance section of the</span></div><div class="line"><span class="comment"># administrator guide before turning on autopurge.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The number of snapshots to retain in dataDir</span></div><div class="line">autopurge.<span class="attr">snapRetainCount=3</span></div><div class="line"><span class="comment"># Purge task interval in hours</span></div><div class="line"><span class="comment"># Set to "0" to disable auto purge feature</span></div><div class="line">autopurge.<span class="attr">purgeInterval=1</span></div><div class="line"></div><div class="line"><span class="comment">#kafka01 (10.100.158.245)</span></div><div class="line">server.<span class="number">1</span>=<span class="number">10.100</span>.<span class="number">158.245</span>:<span class="number">2888</span>:<span class="number">3888</span></div><div class="line"><span class="comment">#kafka02 (10.100.19.15)</span></div><div class="line">server.<span class="number">2</span>=<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">2888</span>:<span class="number">3888</span></div><div class="line"><span class="comment">#kafka03 (10.100.124.217)</span></div><div class="line">server.<span class="number">3</span>=<span class="number">10.100</span>.<span class="number">124.217</span>:<span class="number">2888</span>:<span class="number">3888</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="节点三："><a href="#节点三：" class="headerlink" title="节点三："></a>节点三：</h2><ul>
<li><p>docker-compose.yml</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">version</span>: <span class="string">'2'</span></div><div class="line">service<span class="variable">s:</span></div><div class="line">  zookeeper:</div><div class="line">    image: wurstmeister/zookeeper</div><div class="line">    volume<span class="variable">s:</span></div><div class="line">      - ./zoo.<span class="keyword">cf</span><span class="variable">g:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/<span class="keyword">conf</span>/zoo.cfg</div><div class="line">      - ./dat<span class="variable">a:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/data</div><div class="line">      - ./<span class="built_in">log</span><span class="variable">s:</span>/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/logs</div><div class="line">      - ./myid:/<span class="keyword">opt</span>/zookeeper-<span class="number">3.4</span>.<span class="number">9</span>/data/myid</div><div class="line">    port<span class="variable">s:</span></div><div class="line">      - <span class="string">"2179:2181"</span></div><div class="line">      - <span class="string">"2888:2888"</span></div><div class="line">      - <span class="string">"3888:3888"</span></div><div class="line">    restar<span class="variable">t:</span> always</div></pre></td></tr></table></figure>
</li>
<li><p>myid文件</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure>
</li>
<li><p>zoo.cfg文件</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># The number of milliseconds of each tick</span></div><div class="line"><span class="attr">tickTime=2000</span></div><div class="line"><span class="comment"># The number of ticks that the initial</span></div><div class="line"><span class="comment"># synchronization phase can take</span></div><div class="line"><span class="attr">initLimit=10</span></div><div class="line"><span class="comment"># The number of ticks that can pass between</span></div><div class="line"><span class="comment"># sending a request and getting an acknowledgement</span></div><div class="line"><span class="attr">syncLimit=5</span></div><div class="line"><span class="comment"># the directory where the snapshot is stored.</span></div><div class="line"><span class="comment"># do not use /tmp for storage, /tmp here is just</span></div><div class="line"><span class="comment"># example sakes.</span></div><div class="line"><span class="attr">dataDir=/opt/zookeeper-3.4.9/data</span></div><div class="line"><span class="attr">dataLogDir=/opt/zookeeper-3.4.9/logs</span></div><div class="line"><span class="comment"># the port at which the clients will connect</span></div><div class="line"><span class="attr">clientPort=2181</span></div><div class="line"><span class="comment"># the maximum number of client connections.</span></div><div class="line"><span class="comment"># increase this if you need to handle more clients</span></div><div class="line"><span class="comment">#maxClientCnxns=60</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Be sure to read the maintenance section of the</span></div><div class="line"><span class="comment"># administrator guide before turning on autopurge.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The number of snapshots to retain in dataDir</span></div><div class="line">autopurge.<span class="attr">snapRetainCount=3</span></div><div class="line"><span class="comment"># Purge task interval in hours</span></div><div class="line"><span class="comment"># Set to "0" to disable auto purge feature</span></div><div class="line">autopurge.<span class="attr">purgeInterval=1</span></div><div class="line"></div><div class="line"><span class="comment">#kafka01 (10.100.158.245)</span></div><div class="line">server.<span class="number">1</span>=<span class="number">10.100</span>.<span class="number">158.245</span>:<span class="number">2888</span>:<span class="number">3888</span></div><div class="line"><span class="comment">#kafka02 (10.100.19.15)</span></div><div class="line">server.<span class="number">2</span>=<span class="number">10.100</span>.<span class="number">19.15</span>:<span class="number">2888</span>:<span class="number">3888</span></div><div class="line"><span class="comment">#kafka03 (10.100.124.217)</span></div><div class="line">server.<span class="number">3</span>=<span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">2888</span>:<span class="number">3888</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="四、查看ZooKeeper状态"><a href="#四、查看ZooKeeper状态" class="headerlink" title="四、查看ZooKeeper状态"></a>四、查看ZooKeeper状态</h1><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment"># 服务器1</span></div><div class="line"></div><div class="line">[root@VM_158_24_centos ~]<span class="comment"># docker exec -it s1_zookeeper_1 bin/zkServer.sh status</span></div><div class="line"> </div><div class="line">ZooKeeper JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></div><div class="line"> </div><div class="line">Using config: <span class="regexp">/opt/zookeeper-3.4.9/bin/</span>../conf/zoo.cfg</div><div class="line"> </div><div class="line">Mode: leader</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">#服务器2</span></div><div class="line"> </div><div class="line">[root@VM_19_15_centos ~]<span class="comment"># docker exec -it s2_zookeeper_1 bin/zkServer.sh status</span></div><div class="line"> </div><div class="line">ZooKeeper JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></div><div class="line"> </div><div class="line">Using config: <span class="regexp">/opt/zookeeper-3.4.9/bin/</span>../conf/zoo.cfg</div><div class="line"> </div><div class="line">Mode: follower</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">#服务器3</span></div><div class="line"> </div><div class="line">[root@VM_124_27_centos ~]<span class="comment"># docker exec -it s3_zookeeper_1 bin/zkServer.sh status</span></div><div class="line"> </div><div class="line">ZooKeeper JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></div><div class="line"> </div><div class="line">Using config: <span class="regexp">/opt/zookeeper-3.4.9/bin/</span>../conf/zoo.cfg</div><div class="line"> </div><div class="line">Mode: follower</div></pre></td></tr></table></figure>
<p>停掉leader，2个follower的状态有变化，如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"># 服务器<span class="number">1</span></div><div class="line"> </div><div class="line">[root@VM_158_245_centos ~]# docker stop s1_zookeeper_1</div><div class="line">s1_zookeeper_1</div><div class="line"> </div><div class="line"> </div><div class="line"># 服务器<span class="number">2</span></div><div class="line"> </div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">555</span> [myid:<span class="number">2</span>] - WARN [WorkerSender[myid=<span class="number">2</span>]:QuorumCnxManager@<span class="number">400</span>] - Cannot open channel to <span class="number">1</span> <span class="meta">at</span> election address /<span class="number">10.154</span><span class="meta">.158</span><span class="meta">.245</span>:<span class="number">3888</span></div><div class="line"><span class="symbol">java.net.ConnectException:</span> Connection refused</div><div class="line"> <span class="meta">at</span> java.net.PlainSocketImpl.socketConnect(Native Method)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:<span class="number">339</span>)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:<span class="number">200</span>)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:<span class="number">182</span>)</div><div class="line"> <span class="meta">at</span> java.net.SocksSocketImpl.connect(SocksSocketImpl.java:<span class="number">392</span>)</div><div class="line"> <span class="meta">at</span> java.net.Socket.connect(Socket.java:<span class="number">579</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:<span class="number">381</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:<span class="number">354</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.process(FastLeaderElection.java:<span class="number">452</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.run(FastLeaderElection.java:<span class="number">433</span>)</div><div class="line"> <span class="meta">at</span> java.lang.Thread.run(Thread.java:<span class="number">745</span>)</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">556</span> [myid:<span class="number">2</span>] - INFO [WorkerSender[myid=<span class="number">2</span>]:QuorumPeer$QuorumServer@<span class="number">149</span>] - Resolved hostname: <span class="number">10.154</span><span class="meta">.158</span><span class="meta">.245</span> to address: /<span class="number">10.154</span><span class="meta">.158</span><span class="meta">.245</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">556</span> [myid:<span class="number">2</span>] - INFO [WorkerReceiver[myid=<span class="number">2</span>]:FastLeaderElection@<span class="number">600</span>] - Notification: <span class="number">1</span> (message format version), <span class="number">3</span> (n.leader), <span class="number">0x500000000</span> (n.zxid), <span class="number">0xf4</span> (n.round), LOOKING (n.state), <span class="number">2</span> (n.sid), <span class="number">0x5</span> (n.peerEpoch) LOOKING (my state)</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">759</span> [myid:<span class="number">2</span>] - INFO [QuorumPeer[myid=<span class="number">2</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:QuorumPeer@<span class="number">844</span>] - FOLLOWING</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">759</span> [myid:<span class="number">2</span>] - INFO [QuorumPeer[myid=<span class="number">2</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:ZooKeeperServer@<span class="number">173</span>] - Created server with tickTime <span class="number">2000</span> minSessionTimeout <span class="number">4000</span> maxSessionTimeout <span class="number">40000</span> datadir /opt/zookeeper-<span class="number">3.4</span><span class="meta">.9</span>/logs/version-<span class="number">2</span> snapdir /opt/zookeeper-<span class="number">3.4</span><span class="meta">.9</span>/data/version-<span class="number">2</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">759</span> [myid:<span class="number">2</span>] - INFO [QuorumPeer[myid=<span class="number">2</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:Follower@<span class="number">61</span>] - FOLLOWING - LEADER ELECTION TOOK - <span class="number">215</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">760</span> [myid:<span class="number">2</span>] - INFO [QuorumPeer[myid=<span class="number">2</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:QuorumPeer$QuorumServer@<span class="number">149</span>] - Resolved hostname: <span class="number">10.105</span><span class="meta">.124</span><span class="meta">.217</span> to address: /<span class="number">10.105</span><span class="meta">.124</span><span class="meta">.217</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">761</span> [myid:<span class="number">2</span>] - WARN [QuorumPeer[myid=<span class="number">2</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:Learner@<span class="number">236</span>] - Unexpected exception, tries=<span class="number">0</span>, connecting to /<span class="number">10.105</span><span class="meta">.124</span><span class="meta">.217</span>:<span class="number">2888</span></div><div class="line"><span class="symbol">java.net.ConnectException:</span> Connection refused</div><div class="line"> <span class="meta">at</span> java.net.PlainSocketImpl.socketConnect(Native Method)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:<span class="number">339</span>)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:<span class="number">200</span>)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:<span class="number">182</span>)</div><div class="line"> <span class="meta">at</span> java.net.SocksSocketImpl.connect(SocksSocketImpl.java:<span class="number">392</span>)</div><div class="line"> <span class="meta">at</span> java.net.Socket.connect(Socket.java:<span class="number">579</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.Learner.connectToLeader(Learner.java:<span class="number">228</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.Follower.followLeader(Follower.java:<span class="number">69</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:<span class="number">846</span>)</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">45</span>,<span class="number">794</span> [myid:<span class="number">2</span>] - INFO [QuorumPeer[myid=<span class="number">2</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:Learner@<span class="number">329</span>] - Getting a snapshot from leader</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">45</span>,<span class="number">796</span> [myid:<span class="number">2</span>] - INFO [QuorumPeer[myid=<span class="number">2</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:FileTxnSnapLog@<span class="number">240</span>] - Snapshotting: <span class="number">0x500000000</span> to /opt/zookeeper-<span class="number">3.4</span><span class="meta">.9</span>/data/version-<span class="number">2</span>/snapshot<span class="meta">.500000000</span></div><div class="line"> </div><div class="line"> </div><div class="line"># 服务器<span class="number">3</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">567</span> [myid:<span class="number">3</span>] - INFO [QuorumPeer[myid=<span class="number">3</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:FastLeaderElection@<span class="number">818</span>] - New election. My id = <span class="number">3</span>, proposed zxid=<span class="number">0x500000000</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">568</span> [myid:<span class="number">3</span>] - WARN [WorkerSender[myid=<span class="number">3</span>]:QuorumCnxManager@<span class="number">400</span>] - Cannot open channel to <span class="number">1</span> <span class="meta">at</span> election address /<span class="number">10.154</span><span class="meta">.158</span><span class="meta">.245</span>:<span class="number">3888</span></div><div class="line"><span class="symbol">java.net.ConnectException:</span> Connection refused</div><div class="line"> <span class="meta">at</span> java.net.PlainSocketImpl.socketConnect(Native Method)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:<span class="number">339</span>)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:<span class="number">200</span>)</div><div class="line"> <span class="meta">at</span> java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:<span class="number">182</span>)</div><div class="line"> <span class="meta">at</span> java.net.SocksSocketImpl.connect(SocksSocketImpl.java:<span class="number">392</span>)</div><div class="line"> <span class="meta">at</span> java.net.Socket.connect(Socket.java:<span class="number">579</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:<span class="number">381</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:<span class="number">354</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.process(FastLeaderElection.java:<span class="number">452</span>)</div><div class="line"> <span class="meta">at</span> org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.run(FastLeaderElection.java:<span class="number">433</span>)</div><div class="line"> <span class="meta">at</span> java.lang.Thread.run(Thread.java:<span class="number">745</span>)</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">569</span> [myid:<span class="number">3</span>] - INFO [WorkerSender[myid=<span class="number">3</span>]:QuorumPeer$QuorumServer@<span class="number">149</span>] - Resolved hostname: <span class="number">10.154</span><span class="meta">.158</span><span class="meta">.245</span> to address: /<span class="number">10.154</span><span class="meta">.158</span><span class="meta">.245</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">569</span> [myid:<span class="number">3</span>] - INFO [WorkerReceiver[myid=<span class="number">3</span>]:FastLeaderElection@<span class="number">600</span>] - Notification: <span class="number">1</span> (message format version), <span class="number">3</span> (n.leader), <span class="number">0x500000000</span> (n.zxid), <span class="number">0xf4</span> (n.round), LOOKING (n.state), <span class="number">3</span> (n.sid), <span class="number">0x5</span> (n.peerEpoch) LOOKING (my state)</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">575</span> [myid:<span class="number">3</span>] - INFO [WorkerReceiver[myid=<span class="number">3</span>]:FastLeaderElection@<span class="number">600</span>] - Notification: <span class="number">1</span> (message format version), <span class="number">3</span> (n.leader), <span class="number">0x500000000</span> (n.zxid), <span class="number">0xf4</span> (n.round), LOOKING (n.state), <span class="number">2</span> (n.sid), <span class="number">0x5</span> (n.peerEpoch) LOOKING (my state)</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">776</span> [myid:<span class="number">3</span>] - INFO [QuorumPeer[myid=<span class="number">3</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:QuorumPeer@<span class="number">856</span>] - LEADING</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">779</span> [myid:<span class="number">3</span>] - INFO [QuorumPeer[myid=<span class="number">3</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:Leader@<span class="number">59</span>] - TCP NoDelay set to: true</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">780</span> [myid:<span class="number">3</span>] - INFO [QuorumPeer[myid=<span class="number">3</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:ZooKeeperServer@<span class="number">173</span>] - Created server with tickTime <span class="number">2000</span> minSessionTimeout <span class="number">4000</span> maxSessionTimeout <span class="number">40000</span> datadir /opt/zookeeper-<span class="number">3.4</span><span class="meta">.9</span>/logs/version-<span class="number">2</span> snapdir /opt/zookeeper-<span class="number">3.4</span><span class="meta">.9</span>/data/version-<span class="number">2</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">44</span>,<span class="number">780</span> [myid:<span class="number">3</span>] - INFO [QuorumPeer[myid=<span class="number">3</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:Leader@<span class="number">361</span>] - LEADING - LEADER ELECTION TOOK - <span class="number">219</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">45</span>,<span class="number">782</span> [myid:<span class="number">3</span>] - INFO [LearnerHandler-/<span class="number">10.154</span><span class="meta">.19</span><span class="meta">.15</span>:<span class="number">42938</span>:LearnerHandler@<span class="number">329</span>] - Follower sid: <span class="number">2</span> : info : org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer@7f54169</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">45</span>,<span class="number">808</span> [myid:<span class="number">3</span>] - INFO [LearnerHandler-/<span class="number">10.154</span><span class="meta">.19</span><span class="meta">.15</span>:<span class="number">42938</span>:LearnerHandler@<span class="number">384</span>] - Synchronizing with Follower sid: <span class="number">2</span> maxCommittedLog=<span class="number">0x0</span> minCommittedLog=<span class="number">0x0</span> peerLastZxid=<span class="number">0x300000000</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">45</span>,<span class="number">809</span> [myid:<span class="number">3</span>] - INFO [LearnerHandler-/<span class="number">10.154</span><span class="meta">.19</span><span class="meta">.15</span>:<span class="number">42938</span>:LearnerHandler@<span class="number">458</span>] - Sending SNAP</div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">45</span>,<span class="number">809</span> [myid:<span class="number">3</span>] - INFO [LearnerHandler-/<span class="number">10.154</span><span class="meta">.19</span><span class="meta">.15</span>:<span class="number">42938</span>:LearnerHandler@<span class="number">482</span>] - Sending snapshot last zxid of peer is <span class="number">0x300000000</span> zxid of leader is 0x600000000sent zxid of <span class="built_in">db</span> as <span class="number">0x500000000</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">45</span>,<span class="number">820</span> [myid:<span class="number">3</span>] - INFO [LearnerHandler-/<span class="number">10.154</span><span class="meta">.19</span><span class="meta">.15</span>:<span class="number">42938</span>:LearnerHandler@<span class="number">518</span>] - Received NEWLEADER-ACK message from <span class="number">2</span></div><div class="line"><span class="number">2018</span>-<span class="number">10</span>-<span class="number">30</span> <span class="number">10</span>:<span class="number">54</span>:<span class="number">45</span>,<span class="number">820</span> [myid:<span class="number">3</span>] - INFO [QuorumPeer[myid=<span class="number">3</span>]/<span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">2181</span>:Leader@<span class="number">952</span>] - Have quorum of supporters, sids: [ <span class="number">2</span>,<span class="number">3</span> ]<span class="comment">; starting up and setting last processed zxid: 0x600000000</span></div></pre></td></tr></table></figure>
<p>再次查看status:</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line"><span class="comment">#服务器2</span></div><div class="line"> </div><div class="line">[root@VM_19_15_centos ~]<span class="comment"># docker exec -it s2_zookeeper_1 bin/zkServer.sh status</span></div><div class="line"> </div><div class="line">ZooKeeper JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></div><div class="line"> </div><div class="line">Using config: <span class="regexp">/opt/zookeeper-3.4.9/bin/</span>../conf/zoo.cfg</div><div class="line"> </div><div class="line">Mode: follower</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line"><span class="comment">#服务器3</span></div><div class="line"> </div><div class="line">[root@VM_124_217_centos ~]<span class="comment"># docker exec -it s3_zookeeper_1 bin/zkServer.sh status</span></div><div class="line"> </div><div class="line">ZooKeeper JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></div><div class="line"> </div><div class="line">Using config: <span class="regexp">/opt/zookeeper-3.4.9/bin/</span>../conf/zoo.cfg</div><div class="line"> </div><div class="line">Mode: leader</div></pre></td></tr></table></figure>
<p>服务器3变成leader了！</p>
<p>重新启动服务器1，服务器1是follower</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> </div><div class="line">[root@VM_158_245_centos ~]<span class="comment"># docker start s1_zookeeper_1</span></div><div class="line"> </div><div class="line">s1_zookeeper_1</div><div class="line"> </div><div class="line">[root@VM_158_245_centos ~]<span class="comment"># docker exec -it s1_zookeeper_1 bin/zkServer.sh status</span></div><div class="line"> </div><div class="line">ZooKeeper JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></div><div class="line"> </div><div class="line">Using config: <span class="regexp">/opt/zookeeper-3.4.9/bin/</span>../conf/zoo.cfg</div><div class="line"> </div><div class="line">Mode: follower</div></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote>
<p><a href="http://blog.51cto.com/candon123/2050091" target="_blank" rel="external">Configuring Zookeeper Cluster</a></p>
<p><a href="https://www.jianshu.com/p/ea138dba2d36" target="_blank" rel="external">多台虚拟机搭建zookeeper集群</a></p>
<p><a href="https://www.jianshu.com/p/5297773fcc1b" target="_blank" rel="external">搭建kafka集群详细教程</a></p>
<p><a href="https://zookeeper.apache.org/" target="_blank" rel="external">zookeeper.apache.org</a></p>
</blockquote>
</div><div class="tags"><a href="/tags/kafka/">kafka</a><a href="/tags/zookeeper/">zookeeper</a></div><div class="post-nav"><a href="/2018/10/26/kafka-docker/" class="pre">kafka原理及Docker环境部署</a><a href="/2019/03/18/docker-install/" class="next">centos7 安装Docker及docker-compose</a></div><div id="comments"><div id="uyan_frame"></div><script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2141135"></script></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Finance/">Finance</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IOS/">IOS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器/">服务器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统/">系统</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统架构/">系统架构</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/gnome/" style="font-size: 15px;">gnome</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/模式匹配/" style="font-size: 15px;">模式匹配</a> <a href="/tags/PyQt/" style="font-size: 15px;">PyQt</a> <a href="/tags/exe/" style="font-size: 15px;">exe</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/IP代理/" style="font-size: 15px;">IP代理</a> <a href="/tags/multiprocessing/" style="font-size: 15px;">multiprocessing</a> <a href="/tags/多进程/" style="font-size: 15px;">多进程</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/cookie/" style="font-size: 15px;">cookie</a> <a href="/tags/crawler/" style="font-size: 15px;">crawler</a> <a href="/tags/selenium/" style="font-size: 15px;">selenium</a> <a href="/tags/requests/" style="font-size: 15px;">requests</a> <a href="/tags/贝叶斯分类器/" style="font-size: 15px;">贝叶斯分类器</a> <a href="/tags/nltk/" style="font-size: 15px;">nltk</a> <a href="/tags/贝叶斯原理/" style="font-size: 15px;">贝叶斯原理</a> <a href="/tags/pytagcloud/" style="font-size: 15px;">pytagcloud</a> <a href="/tags/标签云/" style="font-size: 15px;">标签云</a> <a href="/tags/招聘/" style="font-size: 15px;">招聘</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/人工智能/" style="font-size: 15px;">人工智能</a> <a href="/tags/系统化交易/" style="font-size: 15px;">系统化交易</a> <a href="/tags/pandas/" style="font-size: 15px;">pandas</a> <a href="/tags/groupby/" style="font-size: 15px;">groupby</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/股票/" style="font-size: 15px;">股票</a> <a href="/tags/g2/" style="font-size: 15px;">g2</a> <a href="/tags/Scrapy/" style="font-size: 15px;">Scrapy</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/表单/" style="font-size: 15px;">表单</a> <a href="/tags/图片上传/" style="font-size: 15px;">图片上传</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/scrapyd/" style="font-size: 15px;">scrapyd</a> <a href="/tags/部署/" style="font-size: 15px;">部署</a> <a href="/tags/bokeh/" style="font-size: 15px;">bokeh</a> <a href="/tags/绘图/" style="font-size: 15px;">绘图</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/eclipse/" style="font-size: 15px;">eclipse</a> <a href="/tags/debug/" style="font-size: 15px;">debug</a> <a href="/tags/iMac/" style="font-size: 15px;">iMac</a> <a href="/tags/SSD/" style="font-size: 15px;">SSD</a> <a href="/tags/USB3-0/" style="font-size: 15px;">USB3.0</a> <a href="/tags/移动硬盘盒/" style="font-size: 15px;">移动硬盘盒</a> <a href="/tags/ireport/" style="font-size: 15px;">ireport</a> <a href="/tags/centos7/" style="font-size: 15px;">centos7</a> <a href="/tags/字体/" style="font-size: 15px;">字体</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/dockerfile/" style="font-size: 15px;">dockerfile</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/ftp/" style="font-size: 15px;">ftp</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/branch/" style="font-size: 15px;">branch</a> <a href="/tags/SourceTree/" style="font-size: 15px;">SourceTree</a> <a href="/tags/DjangoRestFramework/" style="font-size: 15px;">DjangoRestFramework</a> <a href="/tags/API/" style="font-size: 15px;">API</a> <a href="/tags/VNC/" style="font-size: 15px;">VNC</a> <a href="/tags/re/" style="font-size: 15px;">re</a> <a href="/tags/Dockerfile/" style="font-size: 15px;">Dockerfile</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/ownCloud/" style="font-size: 15px;">ownCloud</a> <a href="/tags/网盘/" style="font-size: 15px;">网盘</a> <a href="/tags/Splash/" style="font-size: 15px;">Splash</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Registry/" style="font-size: 15px;">Registry</a> <a href="/tags/highcharts/" style="font-size: 15px;">highcharts</a> <a href="/tags/镜像/" style="font-size: 15px;">镜像</a> <a href="/tags/腾讯云/" style="font-size: 15px;">腾讯云</a> <a href="/tags/阿里云/" style="font-size: 15px;">阿里云</a> <a href="/tags/build/" style="font-size: 15px;">build</a> <a href="/tags/内网映射/" style="font-size: 15px;">内网映射</a> <a href="/tags/端口转发/" style="font-size: 15px;">端口转发</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/日志/" style="font-size: 15px;">日志</a> <a href="/tags/AI/" style="font-size: 15px;">AI</a> <a href="/tags/云计算/" style="font-size: 15px;">云计算</a> <a href="/tags/金融/" style="font-size: 15px;">金融</a> <a href="/tags/seafile/" style="font-size: 15px;">seafile</a> <a href="/tags/postman/" style="font-size: 15px;">postman</a> <a href="/tags/newman/" style="font-size: 15px;">newman</a> <a href="/tags/测试/" style="font-size: 15px;">测试</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/攻击/" style="font-size: 15px;">攻击</a> <a href="/tags/矿机/" style="font-size: 15px;">矿机</a> <a href="/tags/Gunicorn/" style="font-size: 15px;">Gunicorn</a> <a href="/tags/supervisor/" style="font-size: 15px;">supervisor</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a> <a href="/tags/api/" style="font-size: 15px;">api</a> <a href="/tags/redash/" style="font-size: 15px;">redash</a> <a href="/tags/kafka/" style="font-size: 15px;">kafka</a> <a href="/tags/zookeeper/" style="font-size: 15px;">zookeeper</a> <a href="/tags/kafka-manager/" style="font-size: 15px;">kafka-manager</a> <a href="/tags/docker-compose/" style="font-size: 15px;">docker-compose</a> <a href="/tags/Image/" style="font-size: 15px;">Image</a> <a href="/tags/期货/" style="font-size: 15px;">期货</a> <a href="/tags/相似度评价/" style="font-size: 15px;">相似度评价</a> <a href="/tags/分组/" style="font-size: 15px;">分组</a> <a href="/tags/推荐算法/" style="font-size: 15px;">推荐算法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/09/01/jenkins-change-pwd/">jenkins 更换主目录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/01/devops-step3-controller/">【DevOps】第3步:中控平台jenkins</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/09/devops-step2-make-image/">【DevOps】第二步：Docker镜像打包上传至仓库</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/10/devops-step1-dockerfile/">【DevOps】第一步：编写Dockerfile与项目实践</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/10/docker-install/">centos7 安装Docker及docker-compose</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/09/nginx-reload/">【运维】Nginx网关与热部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/18/docker-install/">centos7 安装Docker及docker-compose</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/04/kafka-zookeeper/">kafka集群搭建 - ZooKeeper</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/26/kafka-docker/">kafka原理及Docker环境部署</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/12/redash-use/">redash部署使用</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a><span>联系博主：<a href="mailto:cbbing@163.com" target="_blank" class="fa fa-email"> </a><a href="http://weibo.com/cbbing" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/cbbing" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">Binger Chen</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> </a><span>本站总访问量<span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span>次</span></span></p></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div><script type="text/javascript" src="/js/search.json.js?v=1.3.0"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-69979657-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?336c5d7270cff49527647639835acb15";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script>
<!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
</body></html>