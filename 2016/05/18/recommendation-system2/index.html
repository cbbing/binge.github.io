<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="learn python and invest"><meta name="keywords" content="金融, Python"><title>构建推荐系统（二） | KeKeFund</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.3.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">构建推荐系统（二）</h1><a id="logo" href="/.">KeKeFund</a><p class="description">金融 · Python · 技术博客</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">构建推荐系统（二）</h1><div class="post-meta">May 18, 2016<span> | </span><span class="category"><a href="/categories/机器学习/">机器学习</a></span><span> | </span><span id="busuanzi_value_page_pv"></span><span> Hits</span></div><div class="post-content"><h1 id="基于用户的协同过滤"><a href="#基于用户的协同过滤" class="headerlink" title="基于用户的协同过滤"></a>基于用户的协同过滤</h1><p>我们将一个用户和其他所有用户进行对比，找到相似的人。这种算法有两个弊端：</p>
<ol>
<li><p><strong>扩展性</strong> 随着用户数量的增加，其计算量也会增加。这种算法在只有几千个用户的情况下能够工作得很好，但达到一百万个用户时就会出现瓶颈。</p>
</li>
<li><p><strong>稀疏性</strong> 大多数推荐系统中，物品的数量要远大于用户的数量，因此用户仅仅对一小部分物品进行了评价，这就造成了数据的稀疏性。比如亚马逊有上百万本书，但用户只评论了很少一部分，于是就很难找到两个相似的用户了。</p>
</li>
</ol>
<p>鉴于以上两个局限性，我们不妨考察一下基于物品的协同过滤算法。</p>
<a id="more"></a>
<h1 id="基于物品的协同过滤"><a href="#基于物品的协同过滤" class="headerlink" title="基于物品的协同过滤"></a>基于物品的协同过滤</h1><p>假设我们有一种算法可以计算出两件物品之间的相似度，比如Phoenix专辑和Manners很相似。如果一个用户给Phoenix打了很高的分数，我们就可以向他推荐Manners了。</p>
<h1 id="需要注意这两种算法的区别："><a href="#需要注意这两种算法的区别：" class="headerlink" title="需要注意这两种算法的区别："></a>需要注意这两种算法的区别：</h1><ul>
<li><p>基于用户的协同过滤是通过计算用户之间的距离找出最相似的用户，并将他评价过的物品推荐给目标用户；</p>
</li>
<li><p>而基于物品的协同过滤则是找出最相似的物品，再结合用户的评价来给出推荐结果。</p>
</li>
</ul>
<ul>
<li><p>基于用户的协同过滤又称为内存型协同过滤，因为我们需要将所有的评价数据都保存在内存中来进行推荐。</p>
</li>
<li><p>基于物品的协同过滤也称为基于模型的协同过滤，因为我们不需要保存所有的评价数据，而是通过构建一个物品相似度模型来做推荐。</p>
</li>
</ul>
<h1 id="修正的余弦相似度"><a href="#修正的余弦相似度" class="headerlink" title="修正的余弦相似度"></a>修正的余弦相似度</h1><p>我们使用余弦相似度来计算两个物品的距离。上一章提过“分数膨胀”现象，因此我们会从用户的评价中减去他所有评价的均值，这就是修正的余弦相似度。</p>
<p><img src="http://www.forkosh.com/mathtex.cgi?s(i, j) = \frac{\sum_{u\in U}(R_{u,i} - \overline R_{u})(R_{u,j} - \overline R_{u})} {\sqrt{\sum_{u\in U}(R_{u,i} - \overline R_{u})^2}\sqrt{\sum_{u\in U}(R_{u,j} - \overline R_{u})^2}}"></p>
<p>U表示同时评价过物品i和j的用户集合。</p>
<h1 id="计算修正余弦相似度的Python代码"><a href="#计算修正余弦相似度的Python代码" class="headerlink" title="计算修正余弦相似度的Python代码"></a>计算修正余弦相似度的Python代码</h1><p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/yuxianplus.png" alt=""></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"># -*- codin<span class="variable">g:</span> utf-<span class="number">8</span> -*-</div><div class="line"></div><div class="line">from math import <span class="built_in">sqrt</span></div><div class="line"></div><div class="line">users3 = &#123;<span class="string">"David"</span>: &#123;<span class="string">"Imagine Dragons"</span>: <span class="number">3</span>, <span class="string">"Daft Punk"</span>: <span class="number">5</span>,</div><div class="line">                    <span class="string">"Lorde"</span>: <span class="number">4</span>, <span class="string">"Fall Out Boy"</span>: <span class="number">1</span>&#125;,</div><div class="line">          <span class="string">"Matt"</span>: &#123;<span class="string">"Imagine Dragons"</span>: <span class="number">3</span>, <span class="string">"Daft Punk"</span>: <span class="number">4</span>,</div><div class="line">                   <span class="string">"Lorde"</span>: <span class="number">4</span>, <span class="string">"Fall Out Boy"</span>: <span class="number">1</span>&#125;,</div><div class="line">          <span class="string">"Ben"</span>: &#123;<span class="string">"Kacey Musgraves"</span>: <span class="number">4</span>, <span class="string">"Imagine Dragons"</span>: <span class="number">3</span>,</div><div class="line">                  <span class="string">"Lorde"</span>: <span class="number">3</span>, <span class="string">"Fall Out Boy"</span>: <span class="number">1</span>&#125;,</div><div class="line">          <span class="string">"Chris"</span>: &#123;<span class="string">"Kacey Musgraves"</span>: <span class="number">4</span>, <span class="string">"Imagine Dragons"</span>: <span class="number">4</span>,</div><div class="line">                    <span class="string">"Daft Punk"</span>: <span class="number">4</span>, <span class="string">"Lorde"</span>: <span class="number">3</span>, <span class="string">"Fall Out Boy"</span>: <span class="number">1</span>&#125;,</div><div class="line">          <span class="string">"Tori"</span>: &#123;<span class="string">"Kacey Musgraves"</span>: <span class="number">5</span>, <span class="string">"Imagine Dragons"</span>: <span class="number">4</span>,</div><div class="line">                   <span class="string">"Daft Punk"</span>: <span class="number">5</span>, <span class="string">"Fall Out Boy"</span>: <span class="number">3</span>&#125;&#125;</div><div class="line"></div><div class="line">def computeSimilarity(band1, band2, userRatings):</div><div class="line">    <span class="string">""</span><span class="comment">"</span></div><div class="line">    :param band1：物品<span class="number">1</span></div><div class="line">    :param band2：物品<span class="number">2</span></div><div class="line">    :param userRatings：用户评分dict</div><div class="line"></div><div class="line">    averages = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> (key, ratings) in userRatings.<span class="built_in">items</span>():</div><div class="line">        averages[key] = float(sum(ratings.<span class="built_in">values</span>()))/<span class="built_in">len</span>(ratings.<span class="built_in">values</span>())</div><div class="line"></div><div class="line">    num = <span class="number">0</span> # 分子</div><div class="line">    dem1 = <span class="number">0</span> # 分母的第一部分</div><div class="line">    dem2 = <span class="number">0</span> #</div><div class="line">    <span class="keyword">for</span> (user, ratings) in userRatings.<span class="built_in">items</span>():</div><div class="line">        <span class="keyword">if</span> band1 in ratings <span class="built_in">and</span> band2 in rating<span class="variable">s:</span></div><div class="line">            avg = averages[user]</div><div class="line">            num += (ratings[band1] - avg) * (ratings[band2] - avg)</div><div class="line">            dem1 += (ratings[band1] - avg)**<span class="number">2</span></div><div class="line">            dem2 += (ratings[band2] - avg)**<span class="number">2</span></div><div class="line">    <span class="keyword">return</span> num / (<span class="built_in">sqrt</span>(dem1) * <span class="built_in">sqrt</span>(dem2))</div><div class="line"></div><div class="line"><span class="keyword">print</span> computeSimilarity(<span class="string">'Kacey Musgraves'</span>, <span class="string">'Lorde'</span>, users3)</div><div class="line"><span class="keyword">print</span> computeSimilarity(<span class="string">'Imagine Dragons'</span>, <span class="string">'Lorde'</span>, users3)</div><div class="line"><span class="keyword">print</span> computeSimilarity(<span class="string">'Daft Punk'</span>, <span class="string">'Lorde'</span>, users3)</div><div class="line"></div><div class="line"></div><div class="line">Outpu<span class="variable">t:</span></div><div class="line"></div><div class="line"><span class="number">0.320959291341</span></div><div class="line"></div><div class="line">-<span class="number">0.252526537229</span></div><div class="line"></div><div class="line"><span class="number">0.784114958467</span></div></pre></td></tr></table></figure>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/yuxian_result.png" alt=""></p>
<h1 id="相似度矩阵的预测"><a href="#相似度矩阵的预测" class="headerlink" title="相似度矩阵的预测"></a>相似度矩阵的预测</h1><blockquote>
<p>这个矩阵看起来不错，那下面该如何使用它来做预测呢？比如我想知道David有多喜欢Kecey Musgraves？</p>
</blockquote>
<p><img src="http://www.forkosh.com/mathtex.cgi?p(u, i) = \frac{\sum_{N\in similarTo(i)}(S_{i,N}\times R_{u,N})}{\sum_{N\in similarTo(i)}(|S_{i,N}|)}"></p>
<p>p(u,i)表示我们会来预测用户u对物品i的评分，所以p(David, Kacey Musgraves)就表示我们将预测David会给Kacey打多少分。</p>
<p>N是一个物品的集合，有如下特性：用户u对集合中的物品打过分；物品i和集合中的物品有相似度数据（即上文中的矩阵）。</p>
<p><img src="http://www.forkosh.com/mathtex.cgi?S_{i,n}"> 表示物品i和N的相似度， <img src="http://www.forkosh.com/mathtex.cgi?R_{u,N}">表示用户u对物品N的评分。</p>
<h2 id="归一化转换"><a href="#归一化转换" class="headerlink" title="归一化转换"></a>归一化转换</h2><p>为了让公式的计算效果更佳，对物品的评价分值最好介于-1和1之间。由于我们的评分系统是1至5星，所以需要使用一些运算将其转换到-1至1之间。</p>
<p><img src="http://www.forkosh.com/mathtex.cgi?NR_{u,N} = \frac{2(R_{u,N} - Min_{R}) - (Max_{R} - Min_{R}) }{(Max_{R} - Min_{R})}"></p>
<p>比如一位用户给Fall Out Boy打了2分，那修正后的评分为：</p>
<p>$$ NR_{u,N} = \frac{2(2-1) - (5-1)}{5-1} = -2/4 = -0.5 $$</p>
<p>反过来则是：</p>
<p><img src="http://www.forkosh.com/mathtex.cgi?R_{u,N} = \frac{1}{2}((NR_{u,N} + 1)\times(Max_{R} - Min_{R})) + Min_{R} = \frac12((-0.5 + 1)*4) + 1 = 2"></p>
<p>下表为求得的David的修正评分：</p>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/tuijian3.png" alt=""></p>
<p>则David对Kacey Musgraves的预测评分为：</p>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/tuijian4.png" alt=""></p>
<p>转换为5星评价体系为：</p>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/tuijian5.png" alt=""></p>
<p>最终的预测结果为4.506分。</p>
<h1 id="Slope-One算法"><a href="#Slope-One算法" class="headerlink" title="Slope One算法"></a>Slope One算法</h1><p>还有一种比较流行的基于物品的协同过滤算法，名为Slope One，它的最大的优势是简单，因此易于实现。</p>
<p>我们用一个简单的例子来了解这个算法。假设Amy给PSY打了3分，Whitney Houston打了4份；Ben给PSY打了4分。我们要预测Ben会给Whitney Houston打几分。</p>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/tuijian6.png" alt=""></p>
<h2 id="第一步：计算差值"><a href="#第一步：计算差值" class="headerlink" title="第一步：计算差值"></a>第一步：计算差值</h2><p>我们先为上述例子增加一些数据：</p>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/tuijian7.png" alt=""></p>
<p>计算物品之间差异的公式是：</p>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/tuijian8.png" alt=""></p>
<p>其中，card(S)表示S中有多少个元素；X表示所有评分值的集合；<img src="http://www.forkosh.com/mathtex.cgi?card(S_{i,j}(X))"> 表示同时评价过物品j和i的用户数。</p>
<p>我们来考察PSY和Taylor Swift之间的差值，因为只有两个用户（Amy和Ben）同时对PSY和Taylor Swift打过分。</p>
<p>$$ dev_{swift, psy} = (4-3)/2 + (5-2)/2 = 2 $$</p>
<p>所以PSY和Taylor Swift的差异为2。反过来，Taylor Swift和PSY的差异：</p>
<p>$$ dev_{psy, swift} = (3-4)/2 + (2-5)/2 = -2 $$</p>
<p>其他物品之间的差异</p>
<table>
<thead>
<tr>
<th>0</th>
<th>Taylor Swift</th>
<th>PSY</th>
<th>Whitney Houston</th>
</tr>
</thead>
<tbody>
<tr>
<td>Taylor Swift</td>
<td>0</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>PSY</td>
<td>-2</td>
<td>0</td>
<td>-0.75</td>
</tr>
<tr>
<td>Whitney Houston</td>
<td>-1</td>
<td>0.75</td>
<td>0</td>
</tr>
</tbody>
</table>
<h2 id="第二步：使用加权的Slope-One算法进行预测"><a href="#第二步：使用加权的Slope-One算法进行预测" class="headerlink" title="第二步：使用加权的Slope One算法进行预测"></a>第二步：使用加权的Slope One算法进行预测</h2><p>公式为：</p>
<p><img src="http://7xo67b.com1.z0.glb.clouddn.com/2016-05-17/tuijian9.png" alt=""></p>
<p>其中：</p>
<p><img src="http://www.forkosh.com/mathtex.cgi?C_{j,i} = card(S_{j,i}(X))"></p>
<p><img src="http://www.forkosh.com/mathtex.cgi?P^{WS1}(u)_{j}">表示我们将预测用户u对物品i的评分。比如<img src="http://www.forkosh.com/mathtex.cgi?P^{WS1}(Ben)_{Whitney Houston}">表示Ben对Whitney Houston的预测评分。</p>
<p><img src="http://www.forkosh.com/mathtex.cgi?\sum_{i \in {S(u)-\{j\}} }">表示遍历Ben评价过的所有歌手，除了Whitney Houston之外。</p>
<p>整个分子的意思是：对于Ben评价过的所有歌手（Whitney Houston除外），找出Whitney Houston和这些歌手之间的差值，并将差值加上Ben对这个歌手的评分。同时，我们要将这个结果乘以同时评价过两位歌手的用户数。</p>
<h1 id="Slope-One的Python实现"><a href="#Slope-One的Python实现" class="headerlink" title="Slope One的Python实现"></a>Slope One的Python实现</h1><figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">users2 = &#123;<span class="string">"Amy"</span>: &#123;<span class="string">"Taylor Swift"</span>: <span class="number">4</span>, <span class="string">"PSY"</span>: <span class="number">3</span>, <span class="string">"Whitney Houston"</span>: <span class="number">4</span>&#125;,</div><div class="line">          <span class="string">"Ben"</span>: &#123;<span class="string">"Taylor Swift"</span>: <span class="number">5</span>, <span class="string">"PSY"</span>: <span class="number">2</span>&#125;,</div><div class="line">          <span class="string">"Clara"</span>: &#123;<span class="string">"PSY"</span>: <span class="number">3.5</span>, <span class="string">"Whitney Houston"</span>: <span class="number">4</span>&#125;,</div><div class="line">          <span class="string">"Daisy"</span>: &#123;<span class="string">"Taylor Swift"</span>: <span class="number">5</span>, <span class="string">"Whitney Houston"</span>: <span class="number">3</span>&#125;&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Recommender</span>():</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, data, k=<span class="number">1</span>, metric=<span class="string">'pearson'</span>, n=<span class="number">5</span>)</span></span>:</div><div class="line">        <span class="keyword">self</span>.data = data</div><div class="line">        <span class="comment"># 以下变量将用于Slope One算法</span></div><div class="line">        <span class="keyword">self</span>.frequencies = &#123;&#125;</div><div class="line">        <span class="keyword">self</span>.deviations = &#123;&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">computeDeviations</span><span class="params">(<span class="keyword">self</span>)</span></span>:</div><div class="line">        <span class="string">""</span><span class="string">"</span></div><div class="line">        计算物品之间的差异</div><div class="line">        :return:</div><div class="line">        "<span class="string">""</span></div><div class="line"></div><div class="line">        <span class="comment"># 获取每位用户的评分数据</span></div><div class="line">        <span class="keyword">for</span> ratings <span class="keyword">in</span> <span class="keyword">self</span>.data.values():</div><div class="line">            <span class="comment"># 对于该用户的每个评分项（歌手、分数）</span></div><div class="line">            <span class="keyword">for</span> (item, rating) <span class="keyword">in</span> ratings.items():</div><div class="line">                <span class="keyword">self</span>.frequencies.setdefault(item, &#123;&#125;)</div><div class="line">                <span class="keyword">self</span>.deviations.setdefault(item, &#123;&#125;)</div><div class="line">                <span class="comment"># 再次遍历该用户的每个评分项</span></div><div class="line">                <span class="keyword">for</span> (item2, rating2) <span class="keyword">in</span> ratings.items():</div><div class="line">                    <span class="keyword">if</span> item != <span class="symbol">item2:</span></div><div class="line">                        <span class="comment"># 将评分的差异保存到变量中</span></div><div class="line">                        <span class="keyword">self</span>.frequencies[item].setdefault(item2, <span class="number">0</span>)</div><div class="line">                        <span class="keyword">self</span>.deviations[item].setdefault(item2, <span class="number">0</span>.<span class="number">0</span>)</div><div class="line">                        <span class="keyword">self</span>.frequencies[item][item2] += <span class="number">1</span></div><div class="line">                        <span class="keyword">self</span>.deviations[item][item2] += rating - rating2</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (item, ratings) <span class="keyword">in</span> <span class="keyword">self</span>.deviations.items():</div><div class="line">            <span class="keyword">for</span> item2 <span class="keyword">in</span> <span class="symbol">ratings:</span></div><div class="line">                ratings[item2] /= <span class="keyword">self</span>.frequencies[item][item2]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">slopeOneRecommendations</span><span class="params">(<span class="keyword">self</span>, userRatings)</span></span>:</div><div class="line">        <span class="string">""</span><span class="string">"</span></div><div class="line">        加权的Slope One算法</div><div class="line">        :param userRatings:</div><div class="line">        :return:</div><div class="line">        "<span class="string">""</span></div><div class="line">        recommendations = &#123;&#125;</div><div class="line">        frequencies = &#123;&#125;</div><div class="line">        <span class="comment"># 遍历目标用户的评分项（歌手、分数）</span></div><div class="line">        <span class="keyword">for</span> (userItem, userRating) <span class="keyword">in</span> userRatings.items():</div><div class="line">            <span class="comment"># 对目标用户未评价的歌手进行计算</span></div><div class="line">            <span class="keyword">for</span> (diffItem, diffRatings) <span class="keyword">in</span> <span class="keyword">self</span>.deviations.items():</div><div class="line">                <span class="keyword">if</span> diffItem <span class="keyword">not</span> <span class="keyword">in</span> userRatings <span class="keyword">and</span> userItem <span class="keyword">in</span> <span class="keyword">self</span>.deviations[diffItem]:</div><div class="line">                    freq = <span class="keyword">self</span>.frequencies[diffItem][userItem]</div><div class="line">                    recommendations.setdefault(diffItem, <span class="number">0</span>.<span class="number">0</span>)</div><div class="line">                    frequencies.setdefault(diffItem, <span class="number">0</span>)</div><div class="line">                    <span class="comment"># 分子</span></div><div class="line">                    recommendations[diffItem] += (diffRatings[userItem] + userRating) * freq</div><div class="line">                    <span class="comment"># 分母</span></div><div class="line">                    frequencies[diffItem] += freq</div><div class="line"></div><div class="line">        recommendations = [(k, v / frequencies[k]) <span class="keyword">for</span> (k, v) <span class="keyword">in</span> recommendations.items()]</div><div class="line">        <span class="comment"># 排序并返回</span></div><div class="line">        recommendations.sort(key=lambda <span class="symbol">artistTuple:</span> artistTuple[<span class="number">1</span>], reverse=True)</div><div class="line">        <span class="keyword">return</span> recommendations</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;</span>&gt; r = Recommender()</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; r.computeDeviations()</div><div class="line"><span class="meta">&gt;&gt;</span>&gt; r.deviations</div><div class="line">&#123;<span class="string">'PSY'</span>: &#123;<span class="string">'Taylor Swift'</span>: -<span class="number">2.0</span>, <span class="string">'Whitney Houston'</span>: -<span class="number">0</span>.<span class="number">75</span>&#125;, <span class="string">'Taylor Swift'</span>: &#123;<span class="string">'PSY'</span>: <span class="number">2.0</span>, <span class="string">'Whitney Houston'</span>: <span class="number">1.0</span>&#125;, <span class="string">'Whitney Houston'</span>: &#123;<span class="string">'PSY'</span>: <span class="number">0</span>.<span class="number">75</span>, <span class="string">'Taylor Swift'</span>: -<span class="number">1.0</span>&#125;&#125;</div><div class="line"><span class="meta">&gt;&gt;</span> &gt; r.slopeOneRecommendations(users2[<span class="string">'Ben'</span>])</div><div class="line">    [(<span class="string">'Whitney Houston'</span>, <span class="number">3.375</span>)]</div></pre></td></tr></table></figure>
<p><em>参考</em></p>
<blockquote>
<p>1,《集体智慧编程》</p>
<p>2, <a href="https://github.com/egrcc/guidetodatamining/blob/master/chapter-3.md" target="_blank" rel="external">https://github.com/egrcc/guidetodatamining/blob/master/chapter-3.md</a></p>
</blockquote>
</div><div class="tags"><a href="/tags/Python/">Python</a><a href="/tags/机器学习/">机器学习</a><a href="/tags/推荐算法/">推荐算法</a></div><div class="post-nav"><a href="/2016/05/11/recommendation-system/" class="pre">构建推荐系统（一）</a><a href="/2016/05/27/gensim-similarity/" class="next">gensim文档相似度判断</a></div><div id="comments"><div id="uyan_frame"></div><script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2141135"></script></div><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Finance/">Finance</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/IOS/">IOS</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nginx/">Nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务器/">服务器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/系统/">系统</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/运维/">运维</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/IP代理/" style="font-size: 15px;">IP代理</a> <a href="/tags/re/" style="font-size: 15px;">re</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/模式匹配/" style="font-size: 15px;">模式匹配</a> <a href="/tags/PyQt/" style="font-size: 15px;">PyQt</a> <a href="/tags/exe/" style="font-size: 15px;">exe</a> <a href="/tags/K线/" style="font-size: 15px;">K线</a> <a href="/tags/股票/" style="font-size: 15px;">股票</a> <a href="/tags/期货/" style="font-size: 15px;">期货</a> <a href="/tags/蜡烛图/" style="font-size: 15px;">蜡烛图</a> <a href="/tags/cookie/" style="font-size: 15px;">cookie</a> <a href="/tags/crawler/" style="font-size: 15px;">crawler</a> <a href="/tags/selenium/" style="font-size: 15px;">selenium</a> <a href="/tags/requests/" style="font-size: 15px;">requests</a> <a href="/tags/multiprocessing/" style="font-size: 15px;">multiprocessing</a> <a href="/tags/多进程/" style="font-size: 15px;">多进程</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/招聘/" style="font-size: 15px;">招聘</a> <a href="/tags/机器学习/" style="font-size: 15px;">机器学习</a> <a href="/tags/人工智能/" style="font-size: 15px;">人工智能</a> <a href="/tags/系统化交易/" style="font-size: 15px;">系统化交易</a> <a href="/tags/pytagcloud/" style="font-size: 15px;">pytagcloud</a> <a href="/tags/标签云/" style="font-size: 15px;">标签云</a> <a href="/tags/贝叶斯分类器/" style="font-size: 15px;">贝叶斯分类器</a> <a href="/tags/nltk/" style="font-size: 15px;">nltk</a> <a href="/tags/贝叶斯原理/" style="font-size: 15px;">贝叶斯原理</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/pandas/" style="font-size: 15px;">pandas</a> <a href="/tags/DataFrame/" style="font-size: 15px;">DataFrame</a> <a href="/tags/数据分析/" style="font-size: 15px;">数据分析</a> <a href="/tags/groupby/" style="font-size: 15px;">groupby</a> <a href="/tags/相似度评价/" style="font-size: 15px;">相似度评价</a> <a href="/tags/推荐算法/" style="font-size: 15px;">推荐算法</a> <a href="/tags/gensim/" style="font-size: 15px;">gensim</a> <a href="/tags/主题模型/" style="font-size: 15px;">主题模型</a> <a href="/tags/相似度/" style="font-size: 15px;">相似度</a> <a href="/tags/文档去重/" style="font-size: 15px;">文档去重</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/g2/" style="font-size: 15px;">g2</a> <a href="/tags/分组/" style="font-size: 15px;">分组</a> <a href="/tags/Scrapy/" style="font-size: 15px;">Scrapy</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/bokeh/" style="font-size: 15px;">bokeh</a> <a href="/tags/绘图/" style="font-size: 15px;">绘图</a> <a href="/tags/IOS开发/" style="font-size: 15px;">IOS开发</a> <a href="/tags/Objective-C/" style="font-size: 15px;">Objective-C</a> <a href="/tags/WKWebView/" style="font-size: 15px;">WKWebView</a> <a href="/tags/XCode/" style="font-size: 15px;">XCode</a> <a href="/tags/scrapyd/" style="font-size: 15px;">scrapyd</a> <a href="/tags/部署/" style="font-size: 15px;">部署</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/eclipse/" style="font-size: 15px;">eclipse</a> <a href="/tags/debug/" style="font-size: 15px;">debug</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/表单/" style="font-size: 15px;">表单</a> <a href="/tags/图片上传/" style="font-size: 15px;">图片上传</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/dockerfile/" style="font-size: 15px;">dockerfile</a> <a href="/tags/iMac/" style="font-size: 15px;">iMac</a> <a href="/tags/SSD/" style="font-size: 15px;">SSD</a> <a href="/tags/USB3-0/" style="font-size: 15px;">USB3.0</a> <a href="/tags/移动硬盘盒/" style="font-size: 15px;">移动硬盘盒</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/ireport/" style="font-size: 15px;">ireport</a> <a href="/tags/pdf/" style="font-size: 15px;">pdf</a> <a href="/tags/报告/" style="font-size: 15px;">报告</a> <a href="/tags/centos7/" style="font-size: 15px;">centos7</a> <a href="/tags/字体/" style="font-size: 15px;">字体</a> <a href="/tags/ftp/" style="font-size: 15px;">ftp</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/branch/" style="font-size: 15px;">branch</a> <a href="/tags/SourceTree/" style="font-size: 15px;">SourceTree</a> <a href="/tags/DjangoRestFramework/" style="font-size: 15px;">DjangoRestFramework</a> <a href="/tags/API/" style="font-size: 15px;">API</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/ownCloud/" style="font-size: 15px;">ownCloud</a> <a href="/tags/网盘/" style="font-size: 15px;">网盘</a> <a href="/tags/VNC/" style="font-size: 15px;">VNC</a> <a href="/tags/gnome/" style="font-size: 15px;">gnome</a> <a href="/tags/Dockerfile/" style="font-size: 15px;">Dockerfile</a> <a href="/tags/Splash/" style="font-size: 15px;">Splash</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/AI/" style="font-size: 15px;">AI</a> <a href="/tags/云计算/" style="font-size: 15px;">云计算</a> <a href="/tags/金融/" style="font-size: 15px;">金融</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/日志/" style="font-size: 15px;">日志</a> <a href="/tags/内网映射/" style="font-size: 15px;">内网映射</a> <a href="/tags/端口转发/" style="font-size: 15px;">端口转发</a> <a href="/tags/postman/" style="font-size: 15px;">postman</a> <a href="/tags/newman/" style="font-size: 15px;">newman</a> <a href="/tags/测试/" style="font-size: 15px;">测试</a> <a href="/tags/seafile/" style="font-size: 15px;">seafile</a> <a href="/tags/Registry/" style="font-size: 15px;">Registry</a> <a href="/tags/服务器/" style="font-size: 15px;">服务器</a> <a href="/tags/攻击/" style="font-size: 15px;">攻击</a> <a href="/tags/矿机/" style="font-size: 15px;">矿机</a> <a href="/tags/Jenkins/" style="font-size: 15px;">Jenkins</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/08/29/jenkins-jobs/">jenkins 批量添加任务job</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/24/django-gunicorn/">Django中配置Gunicorn</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/31/attack-miner/">服务器被矿机程序攻击</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/15/api-test/">API自动化测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/24/lanproxy/">内网映射方案(lanproxy)</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/24/seafile-server/">seafile服务器配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/30/supervisor/">Docker容器运行多条命令(supervisor)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/06/scrapy-and-selenium/">scrapy+selenium爬取UC头条网站</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/27/nginx-log/">nginx日志分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/09/docker-command/">docker命令手册</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a><span>联系博主：<a href="mailto:cbbing@163.com" target="_blank" class="fa fa-email"> </a><a href="http://weibo.com/cbbing" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/cbbing" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">Binger Chen</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> </a><span>本站总访问量<span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span>次</span></span></p></div><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div><script type="text/javascript" src="/js/search.json.js?v=1.3.0"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-69979657-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?336c5d7270cff49527647639835acb15";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script>
<!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
</body></html>